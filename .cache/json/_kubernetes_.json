{"data":{"markdownRemark":{"html":"<h1>Kubernetes configuration and authentication</h1>\n<p>Kubernetes is a platform for the orchestration and the management of containers. A Kubernetes cluster is at your disposal and you have access to the namespace named after your group name.</p>\n<p>To start working with Kubernetes, you must have the Kubernetes configuration setup and you must be authentified using our OAuth provider.</p>\n<h3>Kube Config</h3>\n<p>A configuration file known as 'kube config' (commonly located in <code>~/.kube/config</code>) is needed in order to use <code>kubectl</code> and interact with the Kubernetes cluster.</p>\n<p>When interacting with Kubernetes from the <strong>edge node</strong>, the environment is already configured. You can jump to the next section with instructions on how to login and start using <a href=\"/en/docs/kubernetes/kubectl/\"><code>kubectl</code></a>.</p>\n<p>It is also possible to configure other environments such as the one on your host machine with the instruction below.</p>\n<p>Start by <a href=\"https://kubernetes.io/docs/tasks/tools/\">installing <code>kubectl</code></a> following the documentations of your targeted environment. By default, the tool expect the presence of a <code>~/.kube/config</code> file. This file contains the basic information to interact with the Kuberntes cluster. You can gain a copy of its content from the <strong>edge node</strong>:</p>\n<pre><code class=\"language-bash\">cat /etc/kubernetes/base_config\n</code></pre>\n<p>Now import or copy paste its content. For example, from your Linux environment:</p>\n<pre><code class=\"language-bash\">mkdir ~/.kube\n# Replace {username}, enter your password when prompted.\nscp {username}@edge-1.au.adaltas.cloud:/etc/kubernetes/base_confi ~/.kube/config\n</code></pre>\n<h4>Login</h4>\n<p>To login, go to <a href=\"https://k8s-wrk-1.au.adaltas.cloud:32000/auth?client_id=au-k8s&#x26;redirect_uri=http%3A%2F%2Fk8s-adm-1.au.adaltas.cloud%3A5555%2Fcallback&#x26;response_type=code&#x26;scope=groups+audience%3Aserver%3Aclient_id%3Aau-k8s+openid+profile+email+offline_access&#x26;state=I+wish+to+wash+my+irish+wristwatch\">this page</a>.</p>\n<p><img src=\"./assets/login.png\" alt=\"Login page\"></p>\n<p>The credentials are the one you received via email when you were registered to the cluster.</p>\n<p>Once you logged in, click <strong>\"Grant Access\"</strong> then copy the <strong>\"Access Token\"</strong> and <strong>\"Refresh Token\"</strong> in environment variables of your ssh session:</p>\n<pre><code>ACCESS_TOKEN=XXXXXX\nREFRESH_TOKEN=XXXXXX\n</code></pre>\n<p>Then run the following command to save these credentials in your local <code>~/.kube/config</code> file:</p>\n<pre><code>kubectl config set-credentials kubernetes-user \\\n   --auth-provider=oidc \\\n   --auth-provider-arg=idp-issuer-url=https://k8s-wrk-1.au.adaltas.cloud:32000 \\\n   --auth-provider-arg=client-id=au-k8s \\\n   --auth-provider-arg=client-secret=ZXhhbXBsZS1hcHAtc2VjcmV0 \\\n   --auth-provider-arg=idp-certificate-authority=/etc/ipa/ca.crt \\\n   --auth-provider-arg=refresh-token=$REFRESH_TOKEN \\\n   --auth-provider-arg=id-token=$ACCESS_TOKEN\n</code></pre>\n<p>Your <code>~/.kube/config</code> file has been appended with you credentials and you should then be able to run <code>kubectl</code> commands. The token is available for a couple hours.</p>\n<p><strong>Note</strong>: next time you log-in, only the last two fields are required as the others will already be known:</p>\n<pre><code>kubectl config set-credentials kubernetes-user \\\n   --auth-provider-arg=refresh-token=$REFRESH_TOKEN \\\n   --auth-provider-arg=id-token=$ACCESS_TOKEN\n</code></pre>","frontmatter":{"title":"Kubernetes"}}},"pageContext":{"slug":"/kubernetes/"}}